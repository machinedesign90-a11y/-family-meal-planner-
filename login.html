<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Planner - Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen flex items-center justify-center p-4">
  
  <div id="app" class="w-full max-w-md"></div>

  <!-- React from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Supabase Client -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // IMPORTANT: Replace with your actual values
    const SUPABASE_URL = 'https://fgjspmnzeegdtzqpddhh.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZnanNwbW56ZWVnZHR6cXBkZGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNjQyOTIsImV4cCI6MjA4Njc0MDI5Mn0.c-XNp93VDeJwtCNON_NjRwDmn-W7McGnkZSRDe8161w'; // âš ï¸ REPLACE THIS!

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const { useState } = React;

    function AuthPage() {
      const [mode, setMode] = useState('login');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');

      async function handleLogin(e) {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
          const { data, error: loginError } = await supabase.auth.signInWithPassword({
            email,
            password
          });
          
          if (loginError) throw loginError;
          
          // Redirect to main app
          window.location.href = '/index.html';
        } catch (err) {
          setError(err.message || 'Login failed. Please check your credentials.');
        } finally {
          setLoading(false);
        }
      }

      async function handleSignup(e) {
        e.preventDefault();
        setLoading(true);
        setError('');

        if (!name.trim()) {
          setError('Please enter your name');
          setLoading(false);
          return;
        }

        const profile = {
          name: name.trim(),
          age: 30,
          height: 170,
          weight: 70,
          gender: 'male',
          goal: 'maintenance',
          dietary_preference: 'omnivore',
          target_calories: 2000
        };

        try {
          const response = await fetch('/api/auth/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password, name: profile.name, profile })
          });
          
          const data = await response.json();
          
          if (!response.ok) {
            throw new Error(data.error || 'Signup failed');
          }

          setSuccess('Account created! Please log in.');
          setTimeout(() => {
            setMode('login');
            setPassword('');
            setSuccess('');
          }, 2000);
        } catch (err) {
          setError(err.message || 'Signup failed. Please try again.');
        } finally {
          setLoading(false);
        }
      }

      return React.createElement('div', { className: 'bg-white rounded-2xl shadow-2xl p-8' },
        // Header
        React.createElement('div', { className: 'text-center mb-8' },
          React.createElement('h1', { 
            className: 'text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent' 
          }, 'ðŸ½ï¸ Meal Planner'),
          React.createElement('p', { className: 'text-gray-600 mt-2' },
            mode === 'login' ? 'Welcome back!' : 'Create your account'
          )
        ),

        // Error/Success Messages
        error && React.createElement('div', { 
          className: 'mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm' 
        }, error),
        
        success && React.createElement('div', { 
          className: 'mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm' 
        }, success),

        // Forms
        mode === 'login' ? (
          React.createElement('form', { onSubmit: handleLogin, className: 'space-y-4' },
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Email'),
              React.createElement('input', {
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                required: true,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                placeholder: 'your@email.com',
                disabled: loading
              })
            ),
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Password'),
              React.createElement('input', {
                type: 'password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                required: true,
                minLength: 6,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢',
                disabled: loading
              })
            ),
            React.createElement('button', {
              type: 'submit',
              disabled: loading,
              className: 'w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed'
            }, loading ? 'Logging in...' : 'Login')
          )
        ) : (
          React.createElement('form', { onSubmit: handleSignup, className: 'space-y-4' },
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Name'),
              React.createElement('input', {
                type: 'text',
                value: name,
                onChange: (e) => setName(e.target.value),
                required: true,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                placeholder: 'Your name',
                disabled: loading
              })
            ),
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Email'),
              React.createElement('input', {
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                required: true,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                placeholder: 'your@email.com',
                disabled: loading
              })
            ),
            React.createElement('div', {},
              React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Password'),
              React.createElement('input', {
                type: 'password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                required: true,
                minLength: 6,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢',
                disabled: loading
              }),
              React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'At least 6 characters')
            ),
            React.createElement('button', {
              type: 'submit',
              disabled: loading,
              className: 'w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transform hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed'
            }, loading ? 'Creating account...' : 'Create Account')
          )
        ),

        // Toggle Mode
        React.createElement('div', { className: 'mt-6 text-center' },
          React.createElement('button', {
            onClick: () => {
              setMode(mode === 'login' ? 'signup' : 'login');
              setError('');
              setSuccess('');
            },
            type: 'button',
            className: 'text-blue-600 hover:text-blue-700 text-sm font-medium'
          }, mode === 'login' 
            ? "Don't have an account? Sign up" 
            : 'Already have an account? Login'
          )
        )
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(React.createElement(AuthPage));
  </script>
</body>
</html>
